var BJ_REPORT=function(u){if(u.BJ_REPORT)return u.BJ_REPORT;var s={},l=[],f={id:0,uin:0,repeat:3,url:"",combo:1,ext:{},level:4,ignore:[],random:1,delay:1e3,submit:null},p=function(e,r){return Object.prototype.toString.call(e)==="[object "+(r||"Object")+"]"},c=function(e){return"object"===typeof e&&!!e},a=u.onerror;u.onerror=function(e,r,t,n,o){var i=e;o&&o.stack&&(i=g(o)),p(i,"Event")&&(i+=i.type?"--"+i.type+"--"+(i.target?i.target.tagName+"::"+i.target.src:""):""),O.push({msg:i,target:r,rowNum:t,colNum:n}),y(),a&&a.apply(u,arguments)};var g=function(e){var r=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,5).join("@").replace(/\?[^:]+/gi,""),t=e.toString();return r.indexOf(t)<0&&(r=t+"@"+r),r},m=function(e,r){var t,n=[],o=[],i=[];if(c(e))for(var u in e.level=e.level||f.level,e){var a=e[u];if(null!==(t=a)&&(p(t,"Number")||t)){if(c(a))try{a=JSON.stringify(a)}catch(e){a="[BJ_REPORT detect value stringify error] "+e.toString()}i.push(u+":"+a),n.push(u+"="+a),o.push(u+"["+r+"]="+a)}}return[o.join("&"),i.join(","),n.join("&")]},v=[],d=function(e){var r,t={},n=parseInt(f.id,10);if(n){for(var o in t={id:n,ext:JSON.stringify(f.ext)},e)t[o]=e[o];var i=JSON.stringify(t);if(!((s[u=i]=(parseInt(s[u],10)||0)+1)>f.repeat)){var u,a="?bl_param="+encodeURIComponent(i)+"&t="+ +new Date;if(r=f.url+a,f.submit)f.submit(r);else{var c=new Image;v.push(c),c.src=r}}}},h=[],R=0,y=function(e){for(;l.length;){var r=!1,t=l.shift(),n=m(t,h.length);if(p(f.ignore,"Array"))for(var o=0,i=f.ignore.length;o<i;o++){var u=f.ignore[o];if(p(u,"RegExp")&&u.test(n[1])||p(u,"Function")&&u(t,n[1])){r=!0;break}}r||(f.combo?h.push(n[0]):d({error:n[2]}),f.onReport&&f.onReport(f.id,t))}var a=h.length;if(a){var c=function(){clearTimeout(R),d({error:h.join("&")+"&count="+a}),R=0,h=[]};e?c():R||(R=setTimeout(c,f.delay))}},O={push:function(e){return Math.random()>=f.random||(l.push(c(e)?function(r){try{if(r.stack){var e=r.stack.match("https?://[^\n]+"),t=(e=e?e[0]:"").match(":(\\d+):(\\d+)");return t||(t=[0,0,0]),{msg:g(r),rowNum:t[1],colNum:t[2],target:e.replace(t[0],"")}}return r.name&&r.message&&r.description?{msg:JSON.stringify(r)}:r}catch(e){return r}}(e):{msg:e}),y()),O},report:function(e){return e&&O.push(e),y(!0),O},info:function(e){return e&&(c(e)?e.level=2:e={msg:e,level:2},O.push(e)),O},debug:function(e){return e&&(c(e)?e.level=1:e={msg:e,level:1},O.push(e)),O},init:function(e){if(c(e))for(var r in e)f[r]=e[r];return O},__onerror__:u.onerror};return"undefined"!=typeof console&&console.error&&setTimeout(function(){var e=((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2];e&&console.error("BJ_ERROR",decodeURIComponent(e).replace(/(:\d+:\d+)\s*/g,"$1\n"))},0),O}(window);"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=BJ_REPORT),exports.BJ_REPORT=BJ_REPORT);