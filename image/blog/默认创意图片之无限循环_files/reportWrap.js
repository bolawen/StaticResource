(function(root){if(!root.BJ_REPORT){return}var _onthrow=function(errObj){root.BJ_REPORT.report(errObj)};var tryJs=root.BJ_REPORT.tryJs=function init(throwCb){throwCb&&(_onthrow=throwCb);return tryJs};var _merge=function(org,obj){var key;for(key in obj){org[key]=obj[key]}};var _isFunction=function(foo){return typeof foo==="function"};var timeoutkey;var cat=function(foo,args){return function(){try{return foo.apply(this,args||arguments)}catch(error){if(root&&error&&typeof error=="object"&&root.log_biz_tag_type){error.biz_tag_type=root.log_biz_tag_type}_onthrow(error);if(error.stack&&console&&console.error){console.error("[BJ-REPORT]",error.stack)}if(!timeoutkey){var orgOnerror=root.onerror;root.onerror=function(){};timeoutkey=setTimeout(function(){root.onerror=orgOnerror;timeoutkey=null},50)}throw error}}};var catArgs=function(foo){return function(){var arg,args=[];for(var i=0,l=arguments.length;i<l;i++){arg=arguments[i];_isFunction(arg)&&(arg=cat(arg));args.push(arg)}return foo.apply(this,args)}};var catTimeout=function(foo){return function(cb,timeout){if(typeof cb==="string"){try{cb=new Function(cb)}catch(err){throw err}}var args=[].slice.call(arguments,2);cb=cat(cb,args.length&&args);return foo(cb,timeout)}};var makeArgsTry=function(foo,self){return function(){var arg,tmp,args=[];for(var i=0,l=arguments.length;i<l;i++){arg=arguments[i];_isFunction(arg)&&(tmp=cat(arg))&&(arg.tryWrap=tmp)&&(arg=tmp);args.push(arg)}return foo.apply(self||this,args)}};var makeObjTry=function(obj){var key,value;for(key in obj){value=obj[key];if(_isFunction(value))obj[key]=cat(value)}return obj};tryJs.spyJquery=function(){var _$=root.$;if(!_$||!_$.event){return tryJs}var _add,_remove;if(_$.zepto){_add=_$.fn.on,_remove=_$.fn.off;_$.fn.on=makeArgsTry(_add);_$.fn.off=function(){var arg,args=[];for(var i=0,l=arguments.length;i<l;i++){arg=arguments[i];_isFunction(arg)&&arg.tryWrap&&(arg=arg.tryWrap);args.push(arg)}return _remove.apply(this,args)}}else if(window.jQuery){_add=_$.event.add,_remove=_$.event.remove;_$.event.add=makeArgsTry(_add);_$.event.remove=function(){var arg,args=[];for(var i=0,l=arguments.length;i<l;i++){arg=arguments[i];_isFunction(arg)&&arg.tryWrap&&(arg=arg.tryWrap);args.push(arg)}return _remove.apply(this,args)}}var _ajax=_$.ajax;if(_ajax){_$.ajax=function(url,setting){if(!setting){setting=url;url=undefined}makeObjTry(setting);if(url)return _ajax.call(_$,url,setting);return _ajax.call(_$,setting)}}return tryJs};tryJs.spyModules=function(){var _require=root.require,_define=root.define;if(_define&&_define.amd&&_require){root.require=catArgs(_require);_merge(root.require,_require);root.define=catArgs(_define);_merge(root.define,_define)}if(root.seajs&&_define){root.define=function(){var arg,args=[];for(var i=0,l=arguments.length;i<l;i++){arg=arguments[i];if(_isFunction(arg)){arg=cat(arg);arg.toString=function(orgArg){return function(){return orgArg.toString()}}(arguments[i])}args.push(arg)}return _define.apply(this,args)};root.seajs.use=catArgs(root.seajs.use);_merge(root.define,_define)}return tryJs};tryJs.spySystem=function(){root.setTimeout=catTimeout(root.setTimeout);root.setInterval=catTimeout(root.setInterval);return tryJs};tryJs.spyCustom=function(obj){if(_isFunction(obj)){return cat(obj)}else{return makeObjTry(obj)}};tryJs.spyAll=function(){tryJs.spyJquery().spyModules().spySystem();return tryJs}})(window);